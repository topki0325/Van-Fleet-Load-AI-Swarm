<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vangriten AI Swarm</title>
  </head>
  <body>
    <main>
      <h1>Vangriten AI Swarm</h1>
      <p>Status viewer (Tauri commands via <code>window.__TAURI__.tauri.invoke</code>).</p>

      <div>
        <button id="refresh">Refresh</button>
        <button id="deploy">Deploy Sample Project</button>
        <button id="lease">Request Sample Compute</button>
      </div>

      <h2>Swarm</h2>
      <pre id="swarm">(not loaded)</pre>

      <h2>Resource Manager</h2>
      <div>
        <button id="discover-nodes">Discover Nodes</button>
        <button id="list-nodes">List Nodes</button>
        <button id="refresh-nodes">Refresh</button>
      </div>
      <pre id="nodes-output">(not loaded)</pre>

      <h2>Remote Access</h2>
      <div>
        <label>
          Allow Remote Access:
          <input type="checkbox" id="remote-access-toggle" />
        </label>
        <button id="get-remote-status">Get Status</button>
      </div>
      <pre id="remote-access-output">(not loaded)</pre>

      <h2>Swarm Groups</h2>
      <div>
        <label>
          Group Name:
          <input id="group-name" value="My Swarm Group" />
        </label>
        <label>
          Max Members:
          <input id="max-members" type="number" value="10" />
        </label>
        <button id="create-group">Create Group</button>
        <button id="list-groups">List Groups</button>
      </div>
      <div>
        <label>
          Group ID:
          <input id="group-id" value="" placeholder="group-uuid" />
        </label>
        <button id="join-group">Join</button>
        <button id="leave-group">Leave</button>
        <button id="get-members">Get Members</button>
      </div>
      <pre id="groups-output">(not loaded)</pre>

      <h2>Resource Allocation</h2>
      <div>
        <label>
          CPU Cores:
          <input id="req-cpu" type="number" value="2" />
        </label>
        <label>
          Memory (MB):
          <input id="req-memory" type="number" value="4096" />
        </label>
        <label>
          GPU Required:
          <input type="checkbox" id="req-gpu" />
        </label>
        <label>
          GPU Memory (MB):
          <input id="req-gpu-memory" type="number" value="8192" />
        </label>
      </div>
      <div>
        <label>
          Task Type:
          <input id="task-type" value="inference" />
        </label>
        <label>
          Priority:
          <select id="req-priority">
            <option value="Low">Low</option>
            <option value="Medium" selected>Medium</option>
            <option value="High">High</option>
            <option value="Critical">Critical</option>
          </select>
        </label>
        <button id="request-resources">Request Resources</button>
      </div>
      <div>
        <label>
          Allocation ID:
          <input id="allocation-id" value="" placeholder="allocation-uuid" />
        </label>
        <button id="release-allocation">Release</button>
      </div>
      <pre id="allocation-output">(not loaded)</pre>

      <h2>Health Check</h2>
      <div>
        <label>
          Node ID:
          <input id="health-node-id" value="" placeholder="node-uuid" />
        </label>
        <button id="perform-health-check">Check Health</button>
      </div>
      <pre id="health-output">(not loaded)</pre>

      <h2>Load Balancing</h2>
      <div>
        <label>
          Strategy:
          <select id="balancing-strategy">
            <option value="LeastLoaded" selected>Least Loaded</option>
            <option value="RoundRobin">Round Robin</option>
            <option value="Weighted">Weighted</option>
            <option value="Geographic">Geographic</option>
            <option value="Random">Random</option>
          </select>
        </label>
        <button id="set-strategy">Set Strategy</button>
        <button id="get-strategy">Get Strategy</button>
      </div>
      <pre id="balancing-output">(not loaded)</pre>

      <h2>Resource Pools</h2>
      <div>
        <label>
          Pool Name:
          <input id="pool-name" value="High Performance Pool" />
        </label>
        <label>
          Node IDs (comma separated):
          <input id="pool-node-ids" value="" placeholder="node1,node2,node3" />
        </label>
        <button id="create-pool">Create Pool</button>
        <button id="list-pools">List Pools</button>
      </div>
      <pre id="pools-output">(not loaded)</pre>

      <h2>C Compiler</h2>
      <div>
        <button id="list-gcc">List GCC Instances</button>
        <button id="get-compiler-status">Get Status</button>
      </div>
      <pre id="gcc-output">(not loaded)</pre>

      <h2>C Compilation (Round Robin)</h2>
      <div>
        <label>
          Source Files (comma separated):
          <input id="c-source-files" value="main.c" />
        </label>
        <label>
          Output Path:
          <input id="c-output-path" value="target/main" />
        </label>
        <label>
          Optimization Level:
          <select id="c-optimization">
            <option value="0">O0 - No optimization</option>
            <option value="1">O1 - Basic optimization</option>
            <option value="2" selected>O2 - Recommended</option>
            <option value="3">O3 - Aggressive</option>
            <option value="s">Os - Size optimization</option>
          </select>
        </label>
        <button id="compile-c-round-robin">Compile (Round Robin)</button>
      </div>
      <pre id="c-round-robin-output">(not compiled)</pre>

      <h2>C Compilation (Parallel)</h2>
      <div>
        <label>
          Tasks (JSON array):
          <textarea id="c-parallel-tasks" rows="4" cols="80">[
  {
    "task_id": "task1",
    "source_files": ["file1.c"],
    "output_path": "target/file1",
    "compiler_flags": ["-Wall"],
    "include_paths": [],
    "optimization_level": "2"
  }
]</textarea>
        </label>
        <button id="compile-c-parallel">Compile (Parallel)</button>
      </div>
      <pre id="c-parallel-output">(not compiled)</pre>

      <h2>Ollama</h2>
      <div>
        <button id="ollama-check-connection">Check Connection</button>
        <button id="ollama-list-models">List Models</button>
        <button id="ollama-get-version">Get Version</button>
        <button id="ollama-get-usage-stats">Get Usage Stats</button>
        <button id="ollama-reset-usage-stats">Reset Usage Stats</button>
      </div>
      <pre id="ollama-output">(not loaded)</pre>

      <h2>Ollama Model Management</h2>
      <div>
        <label>
          Model Name:
          <input id="ollama-model-name" value="llama3" />
        </label>
        <button id="ollama-pull-model">Pull Model</button>
        <button id="ollama-delete-model">Delete Model</button>
        <button id="ollama-show-model-info">Show Model Info</button>
      </div>
      <pre id="ollama-model-output">(not loaded)</pre>

      <h2>Ollama Chat (Simple)</h2>
      <div>
        <label>
          Model:
          <input id="ollama-chat-model" value="llama3" />
        </label>
      </div>
      <div>
        <label>
          Prompt:
          <textarea id="ollama-chat-prompt" rows="4" cols="80">Hello, how are you?</textarea>
        </label>
      </div>
      <div>
        <button id="ollama-chat-simple">Chat</button>
      </div>
      <pre id="ollama-chat-output">(no response)</pre>

      <h2>Ollama Generate (Simple)</h2>
      <div>
        <label>
          Model:
          <input id="ollama-generate-model" value="llama3" />
        </label>
      </div>
      <div>
        <label>
          Prompt:
          <textarea id="ollama-generate-prompt" rows="4" cols="80">Write a short poem about programming.</textarea>
        </label>
      </div>
      <div>
        <button id="ollama-generate-simple">Generate</button>
      </div>
      <pre id="ollama-generate-output">(no response)</pre>

      <h2>Ollama Embed</h2>
      <div>
        <label>
          Model:
          <input id="ollama-embed-model" value="llama3" />
        </label>
      </div>
      <div>
        <label>
          Input Text:
          <textarea id="ollama-embed-input" rows="2" cols="80">Hello world</textarea>
        </label>
      </div>
      <div>
        <button id="ollama-embed">Generate Embedding</button>
      </div>
      <pre id="ollama-embed-output">(no embedding)</pre>

      <h2>API Providers</h2>
      <div>
        <button id="get-providers">Load Providers</button>
        <button id="filter-china">China Only</button>
        <button id="filter-usa">USA Only</button>
        <button id="filter-all">All Providers</button>
      </div>
      <pre id="providers-output">(not loaded)</pre>

      <h2>Provider Config</h2>
      <div>
        <label>
          Provider ID:
          <input id="provider-id" value="openai" />
        </label>
        <button id="get-provider-config">Get Config</button>
        <button id="set-default-provider">Set Default</button>
      </div>
      <pre id="provider-config-output">(not loaded)</pre>

      <h2>Vault</h2>
      <div>
        <label>
          Provider:
          <input id="vault-provider" value="openai" />
        </label>
        <label>
          Key:
          <input id="vault-key" value="" placeholder="sk-..." />
        </label>
        <button id="vault-store">Store</button>
        <button id="vault-retrieve">Retrieve</button>
        <button id="vault-list">List Providers</button>
        <button id="vault-delete">Delete</button>
        <button id="vault-usage">Usage</button>
      </div>
      <pre id="vault-output">(not loaded)</pre>

      <h2>Agents</h2>
      <pre id="agents">(not loaded)</pre>

      <h2>Projects</h2>
      <pre id="projects">(not loaded)</pre>

      <h2>Leases</h2>
      <pre id="leases">(not loaded)</pre>

      <h2>Execute Task</h2>
      <div>
        <label>
          Language:
          <input id="task-language" value="rust" />
        </label>
        <label>
          Target:
          <input id="task-target" value="code" />
        </label>
      </div>
      <div>
        <label>
          Context:
          <textarea id="task-context" rows="4" cols="80">Generate a simple function</textarea>
        </label>
      </div>
      <div>
        <button id="execute">Execute</button>
      </div>
      <pre id="task-output">(not executed)</pre>

      <h2>Task Lifecycle</h2>
      <div>
        <label>
          Priority:
          <select id="task-priority">
            <option value="Low">Low</option>
            <option value="Medium" selected>Medium</option>
            <option value="High">High</option>
            <option value="Critical">Critical</option>
          </select>
        </label>
        <label>
          Snapshot Path:
          <input id="task-snapshot" value="snapshots/placeholder.json" />
        </label>
        <button id="submit-task">Submit Task</button>
      </div>
      <div>
        <label>
          Task ID:
          <input id="task-id" value="" placeholder="uuid" />
        </label>
        <label>
          Status Filter:
          <select id="task-filter">
            <option value="">All</option>
            <option value="Pending">Pending</option>
            <option value="Running">Running</option>
            <option value="Completed">Completed</option>
            <option value="Failed">Failed</option>
            <option value="Cancelled">Cancelled</option>
          </select>
        </label>
        <button id="get-task">Get</button>
        <button id="cancel-task">Cancel</button>
        <button id="list-tasks">List All</button>
      </div>
      <pre id="task-list-output">(no tasks loaded)</pre>
    </main>

    <script>
      function pretty(value) {
        try {
          return JSON.stringify(value, null, 2);
        } catch {
          return String(value);
        }
      }

      function setText(id, value) {
        const el = document.getElementById(id);
        if (!el) return;
        el.textContent = value;
      }

      function renderTasks(tasks) {
        if (!Array.isArray(tasks)) {
          return pretty(tasks);
        }

        const filter = document.getElementById('task-filter')?.value || '';
        const filtered = filter
          ? tasks.filter((task) => task.status === filter)
          : tasks;

        if (filtered.length === 0) {
          return '(no matching tasks)';
        }

        return filtered
          .map((task) => {
            const status = task.status || 'Unknown';
            const id = task.id || 'n/a';
            const target = task.spec?.target || 'n/a';
            const language = task.spec?.language || 'n/a';
            const updated = task.updated_at || task.created_at || 'n/a';
            return [
              `[${status}] ${id}`,
              `  target=${target} language=${language}`,
              `  updated=${updated}`,
            ].join('\n');
          })
          .join('\n\n');
      }

      async function getInvoke() {
        const tauri = window.__TAURI__ && window.__TAURI__.tauri;
        if (!tauri || typeof tauri.invoke !== 'function') {
          throw new Error('Tauri invoke not available. Run via the Tauri app (cargo run).');
        }
        return tauri.invoke;
      }

      async function refreshAll() {
        const invoke = await getInvoke();

        const [swarm, agents, projects, leases, tasks] = await Promise.all([
          invoke('cmd_get_swarm_status'),
          invoke('cmd_get_all_agents'),
          invoke('cmd_list_projects'),
          invoke('cmd_list_leases'),
          invoke('cmd_list_tasks'),
        ]);

        setText('swarm', pretty(swarm));
        setText('agents', pretty(agents));
        setText('projects', pretty(projects));
        setText('leases', pretty(leases));
        setText('task-list-output', renderTasks(tasks));
      }

      async function deploySampleProject() {
        const invoke = await getInvoke();
        await invoke('cmd_deploy_project', {
          config: {
            tech_stack: ['rust', 'tauri'],
            default_provider: 'local',
            concurrency_strategy: 'gatling',
          },
        });
        await refreshAll();
      }

      async function requestSampleCompute() {
        const invoke = await getInvoke();
        await invoke('cmd_request_compute', {
          req: {
            gpu_required: false,
            memory_mb: 2048,
            duration_secs: 600,
          },
        });
        await refreshAll();
      }

      async function executeTask() {
        const invoke = await getInvoke();
        const language = document.getElementById('task-language')?.value || 'rust';
        const target = document.getElementById('task-target')?.value || 'code';
        const context_range = document.getElementById('task-context')?.value || '';

        const output = await invoke('cmd_execute_task', {
          task_spec: { language, target, context_range },
        });
        setText('task-output', pretty(output));
        await refreshAll();
      }

      async function submitTask() {
        const invoke = await getInvoke();
        const language = document.getElementById('task-language')?.value || 'rust';
        const target = document.getElementById('task-target')?.value || 'code';
        const context_range = document.getElementById('task-context')?.value || '';
        const priority = document.getElementById('task-priority')?.value || 'Medium';
        const input_snapshot = document.getElementById('task-snapshot')?.value || '';

        const taskId = await invoke('cmd_submit_task', {
          spec: { language, target, context_range },
          priority,
          input_snapshot,
        });

        setText('task-list-output', pretty({ submitted: taskId }));
        await refreshAll();
      }

      async function getTask() {
        const invoke = await getInvoke();
        const task_id = document.getElementById('task-id')?.value || '';
        const task = await invoke('cmd_get_task', { task_id });
        setText('task-list-output', pretty(task));
      }

      async function listTasks() {
        const invoke = await getInvoke();
        const tasks = await invoke('cmd_list_tasks');
        setText('task-list-output', renderTasks(tasks));
      }

      async function cancelTask() {
        const invoke = await getInvoke();
        const task_id = document.getElementById('task-id')?.value || '';
        const ok = await invoke('cmd_cancel_task', { task_id });
        setText('task-list-output', pretty({ cancelled: ok, task_id }));
        await refreshAll();
      }

      document.getElementById('refresh')?.addEventListener('click', () => {
        refreshAll().catch((e) => setText('swarm', String(e)));
      });
      document.getElementById('deploy')?.addEventListener('click', () => {
        deploySampleProject().catch((e) => setText('projects', String(e)));
      });
      document.getElementById('lease')?.addEventListener('click', () => {
        requestSampleCompute().catch((e) => setText('leases', String(e)));
      });
      document.getElementById('execute')?.addEventListener('click', () => {
        executeTask().catch((e) => setText('task-output', String(e)));
      });
      document.getElementById('submit-task')?.addEventListener('click', () => {
        submitTask().catch((e) => setText('task-list-output', String(e)));
      });
      document.getElementById('get-task')?.addEventListener('click', () => {
        getTask().catch((e) => setText('task-list-output', String(e)));
      });
      document.getElementById('cancel-task')?.addEventListener('click', () => {
        cancelTask().catch((e) => setText('task-list-output', String(e)));
      });
      document.getElementById('list-tasks')?.addEventListener('click', () => {
        listTasks().catch((e) => setText('task-list-output', String(e)));
      });
      document.getElementById('task-filter')?.addEventListener('change', () => {
        listTasks().catch((e) => setText('task-list-output', String(e)));
      });

      async function vaultStore() {
        const invoke = await getInvoke();
        const provider = document.getElementById('vault-provider')?.value || '';
        const key = document.getElementById('vault-key')?.value || '';
        const ok = await invoke('cmd_vault_store', { provider, key });
        setText('vault-output', pretty({ stored: ok, provider }));
      }

      async function vaultRetrieve() {
        const invoke = await getInvoke();
        const provider = document.getElementById('vault-provider')?.value || '';
        const key = await invoke('cmd_vault_retrieve', { provider });
        setText('vault-output', pretty({ provider, key }));
      }

      async function vaultList() {
        const invoke = await getInvoke();
        const providers = await invoke('cmd_vault_list');
        setText('vault-output', pretty({ providers }));
      }

      async function vaultDelete() {
        const invoke = await getInvoke();
        const provider = document.getElementById('vault-provider')?.value || '';
        const ok = await invoke('cmd_vault_delete', { provider });
        setText('vault-output', pretty({ deleted: ok, provider }));
      }

      async function vaultUsage() {
        const invoke = await getInvoke();
        const usage = await invoke('cmd_vault_usage');
        setText('vault-output', pretty({ usage }));
      }

      async function loadProviders() {
        const invoke = await getInvoke();
        const providers = await invoke('cmd_get_providers');
        setText('providers-output', pretty(providers));
      }

      async function filterChina() {
        const invoke = await getInvoke();
        const providers = await invoke('cmd_get_providers');
        const chinaProviders = providers.filter(p => p.region === 'China');
        setText('providers-output', pretty(chinaProviders));
      }

      async function filterUSA() {
        const invoke = await getInvoke();
        const providers = await invoke('cmd_get_providers');
        const usaProviders = providers.filter(p => p.region === 'USA');
        setText('providers-output', pretty(usaProviders));
      }

      async function filterAll() {
        await loadProviders();
      }

      async function getProviderConfig() {
        const invoke = await getInvoke();
        const provider = document.getElementById('provider-id')?.value || '';
        const config = await invoke('cmd_get_provider_config', { provider });
        setText('provider-config-output', pretty(config));
      }

      async function setDefaultProvider() {
        const invoke = await getInvoke();
        const provider = document.getElementById('provider-id')?.value || '';
        const result = await invoke('cmd_set_default_provider', { provider });
        setText('provider-config-output', pretty({ default_provider: result }));
      }

      document.getElementById('vault-store')?.addEventListener('click', () => {
        vaultStore().catch((e) => setText('vault-output', String(e)));
      });
      document.getElementById('vault-retrieve')?.addEventListener('click', () => {
        vaultRetrieve().catch((e) => setText('vault-output', String(e)));
      });
      document.getElementById('vault-list')?.addEventListener('click', () => {
        vaultList().catch((e) => setText('vault-output', String(e)));
      });
      document.getElementById('vault-delete')?.addEventListener('click', () => {
        vaultDelete().catch((e) => setText('vault-output', String(e)));
      });
      document.getElementById('vault-usage')?.addEventListener('click', () => {
        vaultUsage().catch((e) => setText('vault-output', String(e)));
      });

      document.getElementById('get-providers')?.addEventListener('click', () => {
        loadProviders().catch((e) => setText('providers-output', String(e)));
      });
      document.getElementById('filter-china')?.addEventListener('click', () => {
        filterChina().catch((e) => setText('providers-output', String(e)));
      });
      document.getElementById('filter-usa')?.addEventListener('click', () => {
        filterUSA().catch((e) => setText('providers-output', String(e)));
      });
      document.getElementById('filter-all')?.addEventListener('click', () => {
        filterAll().catch((e) => setText('providers-output', String(e)));
      });
      document.getElementById('get-provider-config')?.addEventListener('click', () => {
        getProviderConfig().catch((e) => setText('provider-config-output', String(e)));
      });
      document.getElementById('set-default-provider')?.addEventListener('click', () => {
        setDefaultProvider().catch((e) => setText('provider-config-output', String(e)));
      });

      async function discoverNodes() {
        const invoke = await getInvoke();
        const nodes = await invoke('cmd_discover_nodes');
        setText('nodes-output', pretty(nodes));
      }

      async function listNodes() {
        const invoke = await getInvoke();
        const nodes = await invoke('cmd_list_discovered_nodes');
        setText('nodes-output', pretty(nodes));
      }

      async function setRemoteAccess() {
        const invoke = await getInvoke();
        const allow = document.getElementById('remote-access-toggle')?.checked || false;
        await invoke('cmd_set_remote_access', { allow });
        setText('remote-access-output', pretty({ remote_access: allow }));
      }

      async function getRemoteStatus() {
        const invoke = await getInvoke();
        const status = await invoke('cmd_get_remote_access_status');
        setText('remote-access-output', pretty({ remote_access: status }));
        document.getElementById('remote-access-toggle').checked = status;
      }

      async function createGroup() {
        const invoke = await getInvoke();
        const name = document.getElementById('group-name')?.value || '';
        const maxMembers = parseInt(document.getElementById('max-members')?.value || '10');
        const groupId = await invoke('cmd_create_swarm_group', { name, maxMembers });
        setText('groups-output', pretty({ group_id: groupId }));
      }

      async function listGroups() {
        const invoke = await getInvoke();
        const groups = await invoke('cmd_list_swarm_groups');
        setText('groups-output', pretty(groups));
      }

      async function joinGroup() {
        const invoke = await getInvoke();
        const groupId = document.getElementById('group-id')?.value || '';
        await invoke('cmd_join_swarm_group', { groupId });
        setText('groups-output', pretty({ joined: groupId }));
      }

      async function leaveGroup() {
        const invoke = await getInvoke();
        const groupId = document.getElementById('group-id')?.value || '';
        await invoke('cmd_leave_swarm_group', { groupId });
        setText('groups-output', pretty({ left: groupId }));
      }

      async function getGroupMembers() {
        const invoke = await getInvoke();
        const groupId = document.getElementById('group-id')?.value || '';
        const members = await invoke('cmd_get_group_members', { groupId });
        setText('groups-output', pretty(members));
      }

      async function requestResources() {
        const invoke = await getInvoke();
        const requirements = {
          cpu_cores: parseInt(document.getElementById('req-cpu')?.value || '2'),
          memory_mb: parseInt(document.getElementById('req-memory')?.value || '4096'),
          gpu_required: document.getElementById('req-gpu')?.checked || false,
          gpu_memory_mb: parseInt(document.getElementById('req-gpu-memory')?.value || '8192'),
          preferred_models: [],
        };
        const taskType = document.getElementById('task-type')?.value || 'inference';
        const priority = document.getElementById('req-priority')?.value || 'Medium';
        const allocation = await invoke('cmd_request_resources', { requirements, taskType, priority });
        setText('allocation-output', pretty(allocation));
      }

      async function releaseAllocation() {
        const invoke = await getInvoke();
        const allocationId = document.getElementById('allocation-id')?.value || '';
        await invoke('cmd_release_allocation', { allocationId });
        setText('allocation-output', pretty({ released: allocationId }));
      }

      async function performHealthCheck() {
        const invoke = await getInvoke();
        const nodeId = document.getElementById('health-node-id')?.value || '';
        const health = await invoke('cmd_perform_health_check', { nodeId });
        setText('health-output', pretty(health));
      }

      async function setBalancingStrategy() {
        const invoke = await getInvoke();
        const strategy = document.getElementById('balancing-strategy')?.value || 'LeastLoaded';
        await invoke('cmd_set_balancing_strategy', { strategy });
        setText('balancing-output', pretty({ strategy }));
      }

      async function getBalancingStrategy() {
        const invoke = await getInvoke();
        const strategy = await invoke('cmd_get_balancing_strategy');
        setText('balancing-output', pretty(strategy));
      }

      async function createPool() {
        const invoke = await getInvoke();
        const name = document.getElementById('pool-name')?.value || '';
        const nodeIdsStr = document.getElementById('pool-node-ids')?.value || '';
        const nodeIds = nodeIdsStr.split(',').map(s => s.trim()).filter(s => s);
        const poolId = await invoke('cmd_create_resource_pool', { name, nodeIds });
        setText('pools-output', pretty({ pool_id: poolId }));
      }

      async function listPools() {
        const invoke = await getInvoke();
        const pools = await invoke('cmd_list_resource_pools');
        setText('pools-output', pretty(pools));
      }

      document.getElementById('discover-nodes')?.addEventListener('click', () => {
        discoverNodes().catch((e) => setText('nodes-output', String(e)));
      });
      document.getElementById('list-nodes')?.addEventListener('click', () => {
        listNodes().catch((e) => setText('nodes-output', String(e)));
      });
      document.getElementById('refresh-nodes')?.addEventListener('click', () => {
        discoverNodes().catch((e) => setText('nodes-output', String(e)));
      });
      document.getElementById('remote-access-toggle')?.addEventListener('change', () => {
        setRemoteAccess().catch((e) => setText('remote-access-output', String(e)));
      });
      document.getElementById('get-remote-status')?.addEventListener('click', () => {
        getRemoteStatus().catch((e) => setText('remote-access-output', String(e)));
      });
      document.getElementById('create-group')?.addEventListener('click', () => {
        createGroup().catch((e) => setText('groups-output', String(e)));
      });
      document.getElementById('list-groups')?.addEventListener('click', () => {
        listGroups().catch((e) => setText('groups-output', String(e)));
      });
      document.getElementById('join-group')?.addEventListener('click', () => {
        joinGroup().catch((e) => setText('groups-output', String(e)));
      });
      document.getElementById('leave-group')?.addEventListener('click', () => {
        leaveGroup().catch((e) => setText('groups-output', String(e)));
      });
      document.getElementById('get-members')?.addEventListener('click', () => {
        getGroupMembers().catch((e) => setText('groups-output', String(e)));
      });
      document.getElementById('request-resources')?.addEventListener('click', () => {
        requestResources().catch((e) => setText('allocation-output', String(e)));
      });
      document.getElementById('release-allocation')?.addEventListener('click', () => {
        releaseAllocation().catch((e) => setText('allocation-output', String(e)));
      });
      document.getElementById('perform-health-check')?.addEventListener('click', () => {
        performHealthCheck().catch((e) => setText('health-output', String(e)));
      });
      document.getElementById('set-strategy')?.addEventListener('click', () => {
        setBalancingStrategy().catch((e) => setText('balancing-output', String(e)));
      });
      document.getElementById('get-strategy')?.addEventListener('click', () => {
        getBalancingStrategy().catch((e) => setText('balancing-output', String(e)));
      });
      document.getElementById('create-pool')?.addEventListener('click', () => {
        createPool().catch((e) => setText('pools-output', String(e)));
      });
      document.getElementById('list-pools')?.addEventListener('click', () => {
        listPools().catch((e) => setText('pools-output', String(e)));
      });

      async function listGccInstances() {
        const invoke = await getInvoke();
        const instances = await invoke('cmd_list_gcc_instances');
        setText('gcc-output', pretty(instances));
      }

      async function getCompilerStatus() {
        const invoke = await getInvoke();
        const status = await invoke('cmd_get_c_compiler_status');
        setText('gcc-output', pretty(status));
      }

      async function compileCRoundRobin() {
        const invoke = await getInvoke();
        const sourceFiles = document.getElementById('c-source-files')?.value || '';
        const outputPath = document.getElementById('c-output-path')?.value || 'target/main';
        const optimizationLevel = document.getElementById('c-optimization')?.value || '2';
        
        const files = sourceFiles.split(',').map(s => s.trim()).filter(s => s);
        
        const result = await invoke('cmd_compile_c_round_robin', {
          sourceFiles: files,
          outputPath,
          optimizationLevel,
        });
        setText('c-round-robin-output', pretty(result));
      }

      async function compileCParallel() {
        const invoke = await getInvoke();
        const tasksJson = document.getElementById('c-parallel-tasks')?.value || '[]';
        
        try {
          const tasks = JSON.parse(tasksJson);
          const results = await invoke('cmd_compile_c_parallel', { tasks });
          setText('c-parallel-output', pretty(results));
        } catch (e) {
          setText('c-parallel-output', 'Invalid JSON: ' + e);
        }
      }

      document.getElementById('list-gcc')?.addEventListener('click', () => {
        listGccInstances().catch((e) => setText('gcc-output', String(e)));
      });
      document.getElementById('get-compiler-status')?.addEventListener('click', () => {
        getCompilerStatus().catch((e) => setText('gcc-output', String(e)));
      });
      document.getElementById('compile-c-round-robin')?.addEventListener('click', () => {
        compileCRoundRobin().catch((e) => setText('c-round-robin-output', String(e)));
      });
      document.getElementById('compile-c-parallel')?.addEventListener('click', () => {
        compileCParallel().catch((e) => setText('c-parallel-output', String(e)));
      });

      async function ollamaCheckConnection() {
        const invoke = await getInvoke();
        const status = await invoke('cmd_ollama_check_connection');
        setText('ollama-output', pretty(status));
      }

      async function ollamaListModels() {
        const invoke = await getInvoke();
        const models = await invoke('cmd_ollama_list_models');
        setText('ollama-output', pretty(models));
      }

      async function ollamaGetVersion() {
        const invoke = await getInvoke();
        const version = await invoke('cmd_ollama_get_version');
        setText('ollama-output', pretty({ version }));
      }

      async function ollamaGetUsageStats() {
        const invoke = await getInvoke();
        const stats = await invoke('cmd_ollama_get_usage_stats');
        setText('ollama-output', pretty(stats));
      }

      async function ollamaResetUsageStats() {
        const invoke = await getInvoke();
        await invoke('cmd_ollama_reset_usage_stats');
        setText('ollama-output', 'Usage stats reset');
      }

      async function ollamaPullModel() {
        const invoke = await getInvoke();
        const modelName = document.getElementById('ollama-model-name')?.value || '';
        const result = await invoke('cmd_ollama_pull_model', { modelName });
        setText('ollama-model-output', pretty({ result }));
      }

      async function ollamaDeleteModel() {
        const invoke = await getInvoke();
        const modelName = document.getElementById('ollama-model-name')?.value || '';
        const result = await invoke('cmd_ollama_delete_model', { modelName });
        setText('ollama-model-output', pretty({ result }));
      }

      async function ollamaShowModelInfo() {
        const invoke = await getInvoke();
        const modelName = document.getElementById('ollama-model-name')?.value || '';
        const info = await invoke('cmd_ollama_show_model_info', { modelName });
        setText('ollama-model-output', pretty(info));
      }

      async function ollamaChatSimple() {
        const invoke = await getInvoke();
        const model = document.getElementById('ollama-chat-model')?.value || 'llama3';
        const prompt = document.getElementById('ollama-chat-prompt')?.value || '';
        const response = await invoke('cmd_ollama_chat_simple', { model, prompt });
        setText('ollama-chat-output', response);
      }

      async function ollamaGenerateSimple() {
        const invoke = await getInvoke();
        const model = document.getElementById('ollama-generate-model')?.value || 'llama3';
        const prompt = document.getElementById('ollama-generate-prompt')?.value || '';
        const response = await invoke('cmd_ollama_generate_simple', { model, prompt });
        setText('ollama-generate-output', response);
      }

      async function ollamaEmbed() {
        const invoke = await getInvoke();
        const model = document.getElementById('ollama-embed-model')?.value || 'llama3';
        const input = document.getElementById('ollama-embed-input')?.value || '';
        const embedding = await invoke('cmd_ollama_embed', { model, input });
        setText('ollama-embed-output', pretty({ 
          model, 
          input, 
          embedding_length: embedding.length,
          first_10_values: embedding.slice(0, 10)
        }));
      }

      document.getElementById('ollama-check-connection')?.addEventListener('click', () => {
        ollamaCheckConnection().catch((e) => setText('ollama-output', String(e)));
      });
      document.getElementById('ollama-list-models')?.addEventListener('click', () => {
        ollamaListModels().catch((e) => setText('ollama-output', String(e)));
      });
      document.getElementById('ollama-get-version')?.addEventListener('click', () => {
        ollamaGetVersion().catch((e) => setText('ollama-output', String(e)));
      });
      document.getElementById('ollama-get-usage-stats')?.addEventListener('click', () => {
        ollamaGetUsageStats().catch((e) => setText('ollama-output', String(e)));
      });
      document.getElementById('ollama-reset-usage-stats')?.addEventListener('click', () => {
        ollamaResetUsageStats().catch((e) => setText('ollama-output', String(e)));
      });
      document.getElementById('ollama-pull-model')?.addEventListener('click', () => {
        ollamaPullModel().catch((e) => setText('ollama-model-output', String(e)));
      });
      document.getElementById('ollama-delete-model')?.addEventListener('click', () => {
        ollamaDeleteModel().catch((e) => setText('ollama-model-output', String(e)));
      });
      document.getElementById('ollama-show-model-info')?.addEventListener('click', () => {
        ollamaShowModelInfo().catch((e) => setText('ollama-model-output', String(e)));
      });
      document.getElementById('ollama-chat-simple')?.addEventListener('click', () => {
        ollamaChatSimple().catch((e) => setText('ollama-chat-output', String(e)));
      });
      document.getElementById('ollama-generate-simple')?.addEventListener('click', () => {
        ollamaGenerateSimple().catch((e) => setText('ollama-generate-output', String(e)));
      });
      document.getElementById('ollama-embed')?.addEventListener('click', () => {
        ollamaEmbed().catch((e) => setText('ollama-embed-output', String(e)));
      });

      // Auto refresh once on load.
      refreshAll().catch((e) => setText('swarm', String(e)));
    </script>
  </body>
</html>
